---
title: "Now in Android ã«ãŠã‘ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®ç›£è¦–"
emoji: "ğŸŒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Android", "nowinandroid", "network"]
published: false
---

# ã¯ã˜ã‚ã«

æ˜¨ä»Šã® Android ã‚¢ãƒ—ãƒªã¯ãƒ­ãƒ¼ã‚«ãƒ«ã ã‘ã§å®Œçµã›ãšã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã—ã¦ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã»ã¨ã‚“ã©ã ã¨æ€ã„ã¾ã™ã€‚
ãµã¨ã€ã‚¢ãƒ—ãƒªå´ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã©ã†ã‚„ã£ã¦ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã‚‹ã‚“ã ã‚ã†ã¨æ€ã„ã€[Now in Android](https://github.com/android/nowinandroid)ã‚’é¡Œæã«ã—ã¦èª¿æŸ»ã—ã¦ã¿ã¾ã—ãŸã€‚
ã™ã‚‹ã¨ã€çŸ¥è¦‹ãŒå¤šãå¾—ã‚‰ã‚ŒãŸã®ã§å…±æœ‰ã—ã¾ã™ã€‚

# ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã—ã¦ã„ãªã„ã¨ãã®æŒ™å‹•

Now in Android ã§ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã•ã‚Œã¦ã„ãªã„ã¨ãã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
![](/images/snackbar.png)

# æ¦‚è¦

## ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼

ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼ã®éƒ¨åˆ†ã®å®Ÿè£…ã¯ä»¥ä¸‹ã®éƒ¨åˆ†ã«ãªã‚Šã¾ã™
https://github.com/android/nowinandroid/blob/f64f1c0aa2b885b0583dd04a5b4055a8952a2b6e/app/src/main/kotlin/com/google/samples/apps/nowinandroid/ui/NiaApp.kt#L112-L123
`isOffline`ã¨ã„ã†å¤‰æ•°(StateFlow)ã‚’ç”¨ã„ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ¥ç¶šçŠ¶æ³ã‚’ç›£è¦–ã—ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã«ãªã£ãŸã‚‰ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼ã‚’è¡¨ç¤ºã•ã›ã¦ã„ã¾ã™ã€‚ã§ã¯ã€ã•ã‚‰ã«`isOffline`ã®å®Ÿè£…ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
https://github.com/android/nowinandroid/blob/f64f1c0aa2b885b0583dd04a5b4055a8952a2b6e/app/src/main/kotlin/com/google/samples/apps/nowinandroid/ui/NiaAppState.kt#L106-L112
`networkMonitor.isOnline`ã®å‹ã¯`Flow<Boolean>`(å¾Œã§è©³ç´°ã«èª¬æ˜ã—ã¾ã™)ã§ã™ã€‚
ãªã®ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«ç¹‹ãŒã£ã¦ã„ãŸã‚‰å·ã‚’æµã‚Œã‚‹æ¡ƒã®ã‚ˆã†ã«`true`ãŒæµã‚Œã¦ãã¾ã™ã€‚
ã“ã‚Œã‚’ Hot ãª StateFlow ã«å¤‰æ›ã—ã¦å¸¸ã«æœ€æ–°ã®çŠ¶æ…‹ã‚’ç›£è¦–ã—ã¦ã„ã¾ã™ã€‚
`networkMonitor`ã®å‹`NetworkMonitor`ã¯ interface ã§ã‚ã‚Šã€ãã®å®Ÿè£…ã‚¯ãƒ©ã‚¹ã¯ [ConnectivityManagerNetworkMonitor ](https://github.com/android/nowinandroid/blob/f64f1c0aa2b885b0583dd04a5b4055a8952a2b6e/core/data/src/main/kotlin/com/google/samples/apps/nowinandroid/core/data/util/ConnectivityManagerNetworkMonitor.kt)ã«ã‚ã‚Šã¾ã™ã€‚

## ConnectivityManagerNetworkMonitor

[ConnectivityManagerNetworkMonitor](https://github.com/android/nowinandroid/blob/f64f1c0aa2b885b0583dd04a5b4055a8952a2b6e/core/data/src/main/kotlin/com/google/samples/apps/nowinandroid/core/data/util/ConnectivityManagerNetworkMonitor.kt)ã¯ãã®åã®é€šã‚Šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ¥ç¶šæ€§ã‚’ç›£è¦–ã™ã‚‹ã‚¯ãƒ©ã‚¹ã§ã™ã€‚
æœ¬è¨˜äº‹ã®æ®‹ã‚Šã®éƒ¨åˆ†ã§ã¯ã€ConnectivityManagerNetworkMonitorã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã‚ã‚‹`isOnline: Flow<Boolean>`ã®è§£èª¬ã®ã¿è¡Œã„ã¾ã™ã€‚
https://github.com/android/nowinandroid/blob/f64f1c0aa2b885b0583dd04a5b4055a8952a2b6e/core/data/src/main/kotlin/com/google/samples/apps/nowinandroid/core/data/util/ConnectivityManagerNetworkMonitor.kt#L39-L80
### 40~45è¡Œç›®
40è¡Œç›®ã§`ConnectivityManager`ã‚’å®£è¨€ã—ã¦ã„ã¾ã™ã€‚
`ConnectivityManager`ã¯ãƒ‡ãƒã‚¤ã‚¹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹ã§ã€ã‚·ã‚¹ãƒ†ãƒ ã®æ¥ç¶šçŠ¶æ…‹ã‚’ã‚¢ãƒ—ãƒªã«é€šçŸ¥ã—ã¾ã™ã€‚[^1]
ApplicationContextã‹ã‚‰`ConnectivityManager`ã‚’å–å¾—ã—ã¦ã„ã¾ã™ãŒã€nullã®ã¨ãã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«ã¤ãªãŒã£ã¦ã„ãªã„ã®ã§ã€ãƒãƒ£ãƒ³ãƒãƒ«ã«falseã‚’é€ã£ãŸã‚ã¨ã«å³åº§ã«ãƒãƒ£ãƒ³ãƒãƒ«ã‚’é–‰ã˜ã¦ã„ã¾ã™ã€‚

### 51~64è¡Œç›®
https://github.com/android/nowinandroid/blob/b85d149f0d8a9cdc855654459562ebfd47521259/core/data/src/main/kotlin/com/google/samples/apps/nowinandroid/core/data/util/ConnectivityManagerNetworkMonitor.kt#L51-L64
[^1]: https://developer.android.com/reference/android/net/ConnectivityManager