---
title: "Jetpack ComposeでShimmer Effectを実装する"
emoji: "📚"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Android", "jetpackcompose"]
published: false
---
# はじめに
Shimmer Effectとは画像のような、ロード中に表示されるスケルトンスクリーンをキラキラ光らせるエフェクトです。 
![](/images/shimmer.gif)
コンテンツの読み込み中であることがより視覚的にわかるのでユーザーエクスペリエンスの向上が期待できます。
# 方針
Shimmer Effectはカスタムmodifierを用いて実装します。詳細は割愛しますが、modifierは`Modifier`クラスの拡張関数を定義することで自作できます。
また、カスタムmodifier中でrememberなどの状態を追跡する関数を使うときは`composed`関数を使うといいです。

# 実装
```kotlin
fun Modifier.shimmer(
    animationSpec: InfiniteRepeatableSpec<Float> = infiniteRepeatable(
        animation = tween(1500)
    ),
    colors: List<Color> = listOf(
        Color(0xFFB8B5B5),
        Color(0xFF8F8B8B),
        Color(0xFFB8B5B5),
    )
): Modifier = composed {

    var size by remember { mutableStateOf(IntSize(0,0)) }
    val transition = rememberInfiniteTransition()
    val startOffsetX by transition.animateFloat(
        initialValue = -2 * size.width.toFloat(),
        targetValue = 2 * size.width.toFloat(),
        animationSpec = animationSpec
    )

    val linearGradient = Brush.linearGradient(
        colors = colors,
        start = Offset(startOffsetX, 0f),
        end = Offset(startOffsetX + size.width.toFloat(), size.height.toFloat())
    )

    background(linearGradient)
        .onGloballyPositioned { size = it.size }
}

```