---
title: "Jetpack Composeã§Shimmer Effectã‚’ä½œã‚‹"
emoji: "ğŸŒŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [ "Android", "jetpackcompose" , "kotlin"]
published: true
---

# ã¯ã˜ã‚ã«

Shimmer Effectã¨ã¯ç”»åƒã®ã‚ˆã†ãªã€ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚’ã‚­ãƒ©ã‚­ãƒ©å…‰ã‚‰ã›ã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã§ã™ã€‚
![](/images/shimmer.gif)
ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ­ãƒ¼ãƒ‰ä¸­ã§ã‚ã‚‹ã“ã¨ãŒã‚ˆã‚Šè¦–è¦šçš„ã«ã‚ã‹ã‚‹ã®ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã®å‘ä¸ŠãŒæœŸå¾…ã§ãã¾ã™ã€‚

# å®Ÿè£…

```kotlin
fun Modifier.shimmer(
    animationSpec: InfiniteRepeatableSpec<Float> = infiniteRepeatable(
        animation = tween(1500)
    ),
    colors: List<Color> = listOf(
        Color(0xFFB8B5B5),
        Color(0xFFC0C0C0),
        Color(0xFFD3D3D3),
        Color(0xFF808080),
        Color(0xFFB8B5B5)
    )
): Modifier = composed {

    var size by remember { mutableStateOf(IntSize(0,0)) }
    val startOffsetX by rememberInfiniteTransition().animateFloat(
        initialValue = -2 * size.width.toFloat(),
        targetValue = 2 * size.width.toFloat(),
        animationSpec = animationSpec
    )

    val linearGradient = Brush.linearGradient(
        colors = colors,
        start = Offset(startOffsetX, 0f),
        end = Offset(startOffsetX + size.width.toFloat(), size.height.toFloat())
    )

    background(linearGradient)
        .onGloballyPositioned { size = it.size }
}

```

## å¼•æ•°

- `animationSpec`ã¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒå§‹ã¾ã£ã¦ã‹ã‚‰çµ‚ã‚ã‚‹ã¾ã§ã®æ‰€è¦æ™‚é–“ã§ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§1500msã¨ã—ã¦ã„ã¾ã™ãŒã€ãŠå¥½ã¿ã§å¤‰æ›´å¯èƒ½ã§ã™ã€‚ãŠã‚ˆã1000ms~1500msä½ãŒå¦¥å½“ã ã¨æ€ã‚ã‚Œã¾ã™ã€‚
- `colors`ã¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã§é·ç§»ã™ã‚‹è‰²ã®é…åˆ—ã§ã™ã€‚æœ€åˆã®è¦ç´ ã¨æœ€å¾Œã®è¦ç´ ã¯åŒã˜è‰²ã«ã—ã¦ãŠãã¨ã‚¹ãƒ ãƒ¼ã‚ºã«æ„Ÿã˜ã¾ã™

## å†…éƒ¨

- `composed{ }`é–¢æ•°ã¯Modifierãƒ¡ã‚½ãƒƒãƒ‰å†…ã§`remember`ãªã©ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«ãªçŠ¶æ…‹ã‚’æ‰±ã†é–¢æ•°ã‚’ä½¿ç”¨å¯èƒ½ã«ã—ã¦ãã‚Œã¾ã™ã€‚é€šå¸¸ã€`remember`ãªã©ã®Composableé–¢æ•°ã¯@Composableã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒã¤ã„ã¦ã„ãªã„é–¢æ•°ã§ã¯ä½¿ã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ãŒ`composed{ }`ã¯ãã‚Œã‚’å¯èƒ½ã«ã—ã¦ãã‚Œã¾ã™
- `size`ã¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã§ä½¿ç”¨ã™ã‚‹è¦ç´ ã®ã‚µã‚¤ã‚ºã§ã™ã€‚é·ç§»ä¸­ã‚‚`remember`ã§å¸¸ã«è¿½è·¡ã—ã¾ã™ã€‚
- `startOffsetX`ã§ã¯ã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®æ¨ªæ–¹å‘ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’åˆ¶å¾¡ã—ã¦ã„ã¾ã™ã€‚Jetpack Composeã§ç„¡é™ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ‰±ã†ã¨ãã¯`rememberInfiniteTransition`ã‚’ä½¿ã†ã¨ã„ã„ã§ã—ã‚‡ã†ã€‚
https://developer.android.com/jetpack/compose/animation/value-based#rememberinfinitetransition
    - é–‹å§‹ä½ç½®ã¨çµ‚äº†ä½ç½®ã¯ãã‚Œãã‚Œè¦ç´ ã®å·¦å¤–å´ã¨å³å¤–å´ã«é©å½“ã«é…ç½®ã—ã¦ã„ã¾ã™(size.width.toFloat()ã« -1.5 ~ -2 ã‚’æ›ã‘ã‚‹ãã‚‰ã„ãŒå¦¥å½“ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“)
- `linearGradient`ã¯ãªã‚“ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒã©ã†é·ç§»ã™ã‚‹ã‹ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¯æ–œã‚ã«å…‰ã‚‰ã›ãŸã„ã®ã§`linearGradient` ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚é–‹å§‹åœ°ç‚¹ã¯å·¦ä¸Šã€çµ‚äº†åœ°ç‚¹ã¯è¦ç´ ã®å³ä¸‹ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§å·¦ä¸Šã‹ã‚‰å³ä¸‹ã«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒå‹•ä½œã—ã¦ã„ã¾ã™ã€‚
    - `startOffsetX`ã®å¤‰åŒ–ã«å¾“ã£ã¦ã€ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¦ç´ å†…ã‚’ç§»å‹•ã—ã€ã‚­ãƒ©ã£ã¨å…‰ã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ä½œã‚Šå‡ºã—ã¦ã„ã¾ã™ã€‚
- `background(linearGradient).onGloballyPositioned { size = it.size }`ã§ã¯ã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®é·ç§»ã«ã‚ˆã£ã¦æ›´æ–°ã•ã‚Œã‚‹è¦ç´ ã®ã‚µã‚¤ã‚ºã‚’å–å¾—ã—ã¦`size`ã«ä»£å…¥ã—ã¦ã„ã¾ã™

# å‹•ä½œä¾‹

è©¦ã—ã«æ¬¡ã®ã‚ˆã†ãªé©å½“ãªLazyColumnã§Shimmer Effectã‚’èµ°ã‚‰ã›ã¦ã¿ã¾ã™

```kotlin
LazyColumn{
        items(10){
            Row(
                modifier = Modifier.padding(12.dp),
                verticalAlignment = Alignment.CenterVertically
            ) {
                Box(modifier = Modifier
                    .padding(start = 8.dp)
                    .size(72.dp)
                    .clip(CircleShape)
                    .shimmer())
                Column(modifier = Modifier.padding(start = 16.dp)) {
                    Box(modifier = Modifier.width(180.dp).height(20.dp).shimmer())
                    Box(modifier = Modifier.padding(top = 8.dp).width(80.dp).height(30.dp).shimmer())
                }
            }
        }
  }
```
ã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«å‹•ä½œã—ã¾ã™
![](/images/result.gif)

# ãŠã‚ã‚Šã«
ã§ã‚‚å®Ÿéš›ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ãŸã»ã†ãŒã„ã„ã‚ˆã­ã£ã¦ã¯ãªã—
ã‚ˆã•ã’ãªShimmerã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã©ã†ãâ†“
https://github.com/valentinilk/compose-shimmer